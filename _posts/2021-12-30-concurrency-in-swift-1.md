---
layout: post
title: ã€è¯‘ã€‘Swiftå¹¶å‘ç¼–ç¨‹ä¸€
description: è¿™é‡Œæ˜¯`Swiftå¹¶å‘ç¼–ç¨‹ç³»åˆ—`ç¬¬ä¸€ç¯‡ï¼ˆå…±å››ç¯‡ï¼‰ã€‚åŒ…å«ä»¥ä¸‹å†…å®¹ï¼šä¸ºä»€ä¹ˆéœ€è¦å¹¶å‘ç¼–ç¨‹ã€å¹¶å‘äºå¹¶è¡Œçš„åŒºåˆ«ã€GCDä¸­çš„é˜Ÿåˆ—ä¸å‡½æ•°ã€é¢„é˜²æ­»é”ã€`DispatchWorkItem`

category:
  - iOS
tags:
  - Swift
  - GCD
  - Thread
---


> åŸæ–‡åœ°å€ï¼šhttps://ali-akhtar.medium.com/concurrency-in-swift-grand-central-dispatch-part-1-945ff05e8863

![å¹¶å‘äºå¹¶è¡Œçš„åŒºåˆ«](http://images-for-blog.oss-cn-beijing.aliyuncs.com/2022/01/04/0dawoyzkxm3red8.png)

è¿™é‡Œæ˜¯`Swiftå¹¶å‘ç¼–ç¨‹ç³»åˆ—`ç¬¬ä¸€ç¯‡ï¼ˆå…±å››ç¯‡ï¼‰ã€‚åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š
* ä¸ºä»€ä¹ˆéœ€è¦å¹¶å‘ç¼–ç¨‹
* å¹¶å‘äºå¹¶è¡Œçš„åŒºåˆ«
* GCDä¸­çš„é˜Ÿåˆ—ä¸å‡½æ•°
* é¢„é˜²æ­»é”
* `DispatchWorkItem`

## ä¸ºä»€ä¹ˆéœ€è¦å¹¶å‘

å‡è®¾æ‚¨åœ¨ä¸»çº¿ç¨‹ä¸Šå¹¶ä¸”éœ€è¦æ¥è‡ªæœåŠ¡å™¨çš„æ•°æ®ã€‚æ‚¨ä»æœåŠ¡å™¨è¯·æ±‚æ•°æ®å¹¶ç­‰å¾…ï¼Œç›´åˆ°æ‚¨ä»æœåŠ¡å™¨è·å¾—å“åº”ã€‚åœ¨æ­¤æœŸé—´ï¼Œæ‚¨çš„ä¸»çº¿ç¨‹ä¸ä¼šæ‰§è¡Œä»»ä½•ä¸ UI ç›¸å…³çš„å·¥ä½œï¼Œè¿™ä¼šä½¿æ‚¨çš„åº”ç”¨ç¨‹åºæ— å“åº”ã€‚å‡è®¾æœåŠ¡å™¨åœ¨æ­¤æœŸé—´éœ€è¦ 10 ç§’æ‰èƒ½ç»™å‡ºå“åº”ï¼Œå¦‚æœç”¨æˆ·ç‚¹å‡»æŒ‰é’®ï¼Œç³»ç»Ÿå°†ä¸ä¼šå“åº”å®ƒï¼Œè¿™å¯¹ç”¨æˆ·æ¥è¯´éå¸¸ç³Ÿç³•ã€‚

å¦‚æœä½ å¯ä»¥åœ¨åŒä¸€æ—¶é—´ï¼ˆæˆ–å¤§çº¦åœ¨åŒä¸€æ—¶é—´ï¼‰è¿è¡Œçš„è¿™ä¸¤ä¸ªä»»åŠ¡ï¼Œä¸€ä¸ªçº¿ç¨‹ä¸“é—¨å¤„ç†ç”¨æˆ·ç•Œé¢ç›¸å…³çš„å·¥ä½œï¼Œå…¶ä»–çš„çº¿ç¨‹å¤„ç†è€—æ—¶ä»»åŠ¡ã€‚è¿™æ ·ä¸€æ¥ï¼Œä¸Šé¢çš„æƒ…å†µå°±ä¸ä¼šå‘ç”Ÿäº†ã€‚

## å¹¶å‘

å¹¶å‘æ„å‘³å€¼åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨`åˆ†å‰²æ—¶é—´`çš„æ–¹å¼åŒæ—¶å¤„ç†å¤šä¸ªä»»åŠ¡ã€‚å¦‚æœä¸€å°è®¡ç®—æœºåªæœ‰ä¸€ä¸ª`CPU`ï¼Œé‚£ä¹ˆå®ƒæ— æ³•åœ¨ä¸€ä¸ª`ç²¾ç¡®çš„æ—¶é—´ç‚¹`ä¸ŠåŒæ—¶è¿è¡Œå¤šä¸ªä»»åŠ¡ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡`ä¸Šä¸‹æ–‡åˆ‡æ¢`çš„æ–¹å¼åœ¨ä¸€æ®µæ—¶é—´ï¼ˆå¾ˆçŸ­ï¼Œæ¯”å¦‚1sï¼‰å†…æ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚

`ä¸Šä¸‹æ–‡åˆ‡æ¢`æ˜¯æŒ‡å­˜å‚¨çº¿ç¨‹çš„çŠ¶æ€ï¼Œå¹¶åœ¨å°†æ¥æ¢å¤è¿™ä¸ªçŠ¶æ€ç»§ç»­æ‰§è¡Œã€‚è¿™å…è®¸å¤šä¸ªè¿›ç¨‹å…±äº«ä¸€ä¸ª`CPU`èµ„æºï¼ŒåŒæ—¶è¿™ä¹Ÿæ˜¯å¤šä»»åŠ¡æ“ä½œç³»ç»Ÿçš„åŸºæœ¬åŠŸèƒ½ã€‚

## å¹¶è¡Œ

å¹¶è¡ŒæŒ‡å¤šä¸ªä»»åŠ¡åŒæ—¶å‘ç”Ÿï¼Œå¹¶æ²¡æœ‰ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚

å¯¹äºæˆ‘ä»¬è®¨è®ºçš„æƒ…å†µï¼Œå¦‚æœå¹¶è¡Œåœ°æ‰§è¡Œç½‘ç»œè°ƒç”¨ï¼Œé‚£ä¹ˆå°†æœ‰ä¸¤ä¸ªçº¿ç¨‹åœ¨ä¸¤ä¸ªä¸åŒçš„å†…æ ¸ä¸Šæ‰§è¡Œä¸»çº¿ç¨‹å’Œåå°æŒ‡ä»¤ï¼Œä¸å‰ä¸€ä¸ªç›¸æ¯”ï¼Œé€Ÿåº¦éå¸¸å¿«ï¼Œä½†éœ€è¦é¢å¤–çš„ç‰©ç†è¦æ±‚-éœ€è¦`CPU`æœ‰å¤šæ ¸ã€‚

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåœ¨å¹¶è¡Œçš„æƒ…å†µä¸‹ï¼Œä¸¤æ¡çº¿ç¨‹çœŸçš„åœ¨åŒæ—¶æ‰§è¡Œï¼›è€Œå¹¶å‘ï¼Œåœ¨ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œæ—¶ï¼Œå¦ä¸€ä¸ªåœ¨ä¼‘çœ ã€‚
![å¹¶å‘äºå¹¶è¡Œçš„åŒºåˆ«](http://images-for-blog.oss-cn-beijing.aliyuncs.com/2022/01/04/0dawoyzkxm3red8.png)

## å…³äºçº¿ç¨‹çš„å°çŸ¥è¯†

1. åœ¨å•æ ¸`CPU`ä¸Šï¼Œå¦‚æœä½ åˆ›å»ºäº†10æ¡çº¿ç¨‹ï¼Œé‚£ä¹ˆå®ƒåªèƒ½ä½¿ç”¨`å¹¶å‘`/`æ—¶é—´ç‰‡åˆ†å‰²`/`ä¸Šä¸‹æ–‡åˆ‡æ¢`çš„æ–¹å¼æ‰§è¡Œå®ƒä»¬

2. åœ¨`10æ ¸CPU`ä¸Šï¼Œå¦‚æœä½ åˆ›å»ºäº†10æ¡çº¿ç¨‹ï¼Œé‚£ä¹ˆå®ƒä»¬å¯èƒ½ä»¥ä¸‹é¢çš„æ–¹å¼æ‰§è¡Œï¼š
    1. ä½¿ç”¨ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ–¹å¼åœ¨1ä¸ªæ ¸å¿ƒä¸Š`å¹¶å‘`æ‰§è¡Œ
    2. æ¯ä¸ªçº¿ç¨‹åœ¨ç‹¬ç«‹çš„æ ¸å¿ƒä¸Š`å¹¶è¡Œ`æ‰§è¡Œ
    3. ä¸€éƒ¨åˆ†`å¹¶å‘`æ‰§è¡Œï¼Œå¦å¤–ä¸€éƒ¨åˆ†`å¹¶è¡Œ`æ‰§è¡Œ

3. åœ¨å•æ ¸`CPU`ä¸Šï¼Œå¦‚æœä½ åˆ›å»ºäº†1000æ¡çº¿ç¨‹ï¼Œé‚£ä¹ˆ`CPU`åªä¼šå¿™ç€`ä¸Šä¸‹æ–‡åˆ‡æ¢`ï¼Œè€Œä¸ä¼šæ‰§è¡Œå®è´¨æ€§çš„ä»»åŠ¡ã€‚å¯è§ï¼Œåˆ›å»ºåˆç†çš„çº¿ç¨‹æ•°é‡ä¹Ÿæ˜¯ä¸€ä¸ªä¸å°çš„æŒ‘æˆ˜ã€‚

## GCD å¦‚ä½•æ‰§è¡Œå¹¶å‘/å¹¶è¡Œ

GCD åœ¨å¹•åç®¡ç†å…±äº«çº¿ç¨‹æ± å¹¶åœ¨è¯¥æ± ä¸­æ·»åŠ æœ€ä½³çº¿ç¨‹æ•°ã€‚ä½¿ç”¨ GCDï¼Œæ‚¨å°†ä»£ç å—æˆ–å·¥ä½œé¡¹æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ï¼ŒGCD å†³å®šåœ¨å“ªä¸ªçº¿ç¨‹ä¸Šæ‰§è¡Œå®ƒä»¬ã€‚GCD æ ¹æ®ç³»ç»Ÿç‰©ç†æ¡ä»¶æˆ–å½“å‰è´Ÿè½½å¹¶å‘æˆ–å¹¶è¡Œæ‰§è¡Œæ­¤ä»»åŠ¡ã€‚

æ³¨æ„ï¼šå¦‚æœä½ ç»™ GCD åˆ†é…ä¸¤ä¸ªä»»åŠ¡ï¼Œä½ ä¸ç¡®å®šå®ƒæ˜¯å¹¶å‘è¿˜æ˜¯å¹¶è¡Œè¿è¡Œã€‚

ä»ç°åœ¨å¼€å§‹ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æœ¯è¯­`å¹¶å‘`ä»£è¡¨å¹¶å‘/å¹¶è¡Œã€‚

## ä½¿ç”¨GCDï¼Œå¼€å‘è€…æœ‰ä»€ä¹ˆè´£ä»»

æ‚¨æ‰€è¦åšçš„å°±æ˜¯å®šä¹‰è¦å¹¶å‘æ‰§è¡Œçš„ä»»åŠ¡å¹¶å°†å®ƒä»¬æ·»åŠ åˆ°é€‚å½“çš„è°ƒåº¦é˜Ÿåˆ—ä¸­ã€‚GCD è´Ÿè´£åˆ›å»ºæ‰€éœ€çš„çº¿ç¨‹å¹¶å®‰æ’æ‚¨çš„ä»»åŠ¡åœ¨è¿™äº›çº¿ç¨‹ä¸Šè¿è¡Œï¼Œè¿™éå¸¸é…·ğŸ˜ƒ

## è°ƒåº¦é˜Ÿåˆ—

è°ƒåº¦é˜Ÿåˆ—æ˜¯ä¸€ç§åŸºäº C çš„ç»„ä»¶ï¼Œç”¨äºæ‰§è¡Œè‡ªå®šä¹‰ä»»åŠ¡ã€‚è°ƒåº¦é˜Ÿåˆ—æ€»æ˜¯æŒ‰ç…§ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—çš„é¡ºåºå‡ºåˆ—å’Œå¯åŠ¨ä»»åŠ¡ã€‚è°ƒåº¦é˜Ÿåˆ—æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥åŒæ—¶ä»å¤šä¸ªçº¿ç¨‹è®¿é—®å®ƒä»¬ã€‚**æ³¨æ„ï¼Œé˜Ÿåˆ—ä¸æ˜¯çº¿ç¨‹ï¼**

å¦‚æœæ‚¨æƒ³é€šè¿‡ GCD æ‰§è¡Œå¹¶å‘ä»»åŠ¡ï¼Œè¯·å°†å®ƒä»¬æ·»åŠ åˆ°é€‚å½“çš„è°ƒåº¦é˜Ÿåˆ—ä¸­ã€‚GCD å°†åŸºäºé˜Ÿåˆ—çš„é…ç½®ï¼ŒæŒ‘é€‰å¹¶æ‰§è¡Œä»»åŠ¡ã€‚

### ä¸²è¡Œé˜Ÿåˆ—

1. ä¸²è¡Œè°ƒåº¦é˜Ÿåˆ—æŒ‰ç…§æ·»åŠ åˆ°é˜Ÿåˆ—çš„é¡ºåºä¸€æ¬¡æ‰§è¡Œä¸€é¡¹ä»»åŠ¡ã€‚å‡è®¾æ‚¨å°†äº”ä¸ªä»»åŠ¡æ·»åŠ åˆ°ä¸²è¡Œé˜Ÿåˆ—ï¼Œ GCD å°†ä»ç¬¬ä¸€ä¸ªä»»åŠ¡å¼€å§‹ï¼Œåœ¨å®ƒæ‰§è¡Œå®Œæˆä¹‹å‰ï¼Œç¬¬äºŒä¸ªä»»åŠ¡å°†ä¸ä¼šå¼€å§‹ã€‚
2. ä¸²è¡Œé˜Ÿåˆ—é€šå¸¸ç”¨äºåŒæ­¥å¯¹ç‰¹å®šèµ„æºçš„è®¿é—®ã€‚å‡è®¾æ‚¨æœ‰ä¸¤ä¸ªç½‘ç»œè°ƒç”¨éƒ½éœ€è¦ 10 ç§’ï¼Œå› æ­¤æ‚¨å†³å®šå°†è¿™ä¸¤ä¸ªä»»åŠ¡ç§»åˆ°æŸäº›åå°çº¿ç¨‹ä¸Šï¼Œè€Œä¸”å®ƒä»¬éƒ½åœ¨è®¿é—®ç›¸åŒçš„èµ„æºï¼Œæ‚¨æƒ³è¦è¿›è¡Œä¸€äº›åŒæ­¥ï¼Œæ‚¨å¯ä»¥å°†è¿™äº›ä»»åŠ¡æ”¾åœ¨ä¸²è¡Œé˜Ÿåˆ—ä¸­ã€‚
3. ä¸²è¡Œé˜Ÿåˆ—ä¸²è¡Œæ‰§è¡Œä»»åŠ¡æ„å‘³ç€ä¸€æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨ä½¿ç”¨ï¼Œä½†ä¸èƒ½ä¿è¯å®ƒä»¬åœ¨åŒä¸€çº¿ç¨‹ä¸Šæ‰§è¡Œã€‚
4. æ‚¨å¯ä»¥æ ¹æ®éœ€è¦åˆ›å»ºä»»æ„æ•°é‡çš„ä¸²è¡Œé˜Ÿåˆ—ï¼Œå¹¶ä¸”æ¯ä¸ªé˜Ÿåˆ—ç›¸å¯¹äºæ‰€æœ‰å…¶ä»–é˜Ÿåˆ—åŒæ—¶è¿è¡Œã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœæ‚¨åˆ›å»ºå››ä¸ªä¸²è¡Œé˜Ÿåˆ—ï¼Œåˆ™æ¯ä¸ªé˜Ÿåˆ—ä¸€æ¬¡ä»…æ‰§è¡Œä¸€é¡¹ä»»åŠ¡ï¼Œä½†æœ€å¤šä»å¯ä»¥åŒæ—¶æ‰§è¡Œå››ä¸ªä»»åŠ¡ï¼Œæ¯ä¸ªé˜Ÿåˆ—ä¸€ä¸ªã€‚
5. å¦‚æœæ‚¨æœ‰ä¸¤ä¸ªä»»åŠ¡è®¿é—®ç›¸åŒçš„å…±äº«èµ„æºï¼Œä½†ä»–ä»¬åœ¨ä¸åŒçš„çº¿ç¨‹ä¸Šè¿è¡Œï¼Œåˆ™ä»»ä¸€çº¿ç¨‹éƒ½å¯ä»¥å…ˆä¿®æ”¹èµ„æºï¼Œæ‚¨éœ€è¦ä½¿ç”¨é”æ¥ç¡®ä¿ä¸¤ä¸ªä»»åŠ¡ä¸ä¼šåŒæ—¶ä¿®æ”¹è¯¥èµ„æºã€‚æ‚¨å¯ä»¥å°†ä¸¤ä¸ªä»»åŠ¡æ·»åŠ åˆ°ä¸²è¡Œè°ƒåº¦é˜Ÿåˆ—ï¼Œä»¥ç¡®ä¿åœ¨ä»»ä½•ç»™å®šæ—¶é—´åªæœ‰ä¸€ä¸ªä»»åŠ¡ä¿®æ”¹å…±äº«èµ„æºã€‚è¿™ç§åŸºäºé˜Ÿåˆ—çš„åŒæ­¥æ¯”é”æ›´æœ‰æ•ˆï¼Œå› ä¸ºåœ¨æœ‰ç«äº‰å’Œæ— ç«äº‰çš„æƒ…å†µä¸‹ï¼Œé”æ€»æ˜¯éœ€è¦ä¸€ä¸ªæ˜‚è´µçš„å†…æ ¸é™·é˜±ï¼Œè€Œè°ƒåº¦é˜Ÿåˆ—ä¸»è¦åœ¨åº”ç”¨ç¨‹åºçš„è¿›ç¨‹ç©ºé—´ä¸­å·¥ä½œï¼Œå¹¶ä¸”åªåœ¨ç»å¯¹å¿…è¦æ—¶è°ƒç”¨å†…æ ¸ã€‚

### å¹¶å‘é˜Ÿåˆ—

1. å¹¶å‘é˜Ÿåˆ—å¹¶å‘æ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ªä»»åŠ¡
2. å¦‚æœæ‚¨å°†å››ä¸ªå•ç‹¬çš„ä»»åŠ¡æ·»åŠ åˆ°å¹¶å‘é˜Ÿåˆ—ï¼Œè¿™äº›ä»»åŠ¡å°†æŒ‰ç…§å®ƒä»¬æ·»åŠ åˆ°é˜Ÿåˆ—çš„é¡ºåºå¯åŠ¨ã€‚GCD é€‰æ‹©ç¬¬ä¸€ä¸ªä»»åŠ¡åœ¨ä¸€æ®µæ—¶é—´å†…æ‰§è¡Œå®ƒï¼Œç„¶ååœ¨ä¸ç­‰å¾…ç¬¬ä¸€ä¸ªä»»åŠ¡å®Œæˆçš„æƒ…å†µä¸‹å¯åŠ¨ç¬¬äºŒä¸ªä»»åŠ¡ï¼Œä¾æ­¤ç±»æ¨ã€‚è¿™æ˜¯ç†æƒ³çš„åœ°æ–¹ï¼Œè¿™ä¸ä»…å¯ä»¥çœŸæ­£åœ°åšåˆ°åå°æ‰§è¡Œï¼Œè€Œä¸”ä¸å…³å¿ƒè¿™äº›ä»»åŠ¡æ˜¯å¦ä¹Ÿä¸å…¶ä»–ä»»åŠ¡åŒæ—¶è¿è¡Œ
3. å½“å‰æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡åœ¨ç”±è°ƒåº¦é˜Ÿåˆ—ç®¡ç†çš„ä¸åŒçº¿ç¨‹ä¸Šè¿è¡Œã€‚
4. åœ¨ä»»ä½•æ—¶é—´ç‚¹ï¼Œæ‰§è¡Œçš„ä»»åŠ¡æ•°é‡æ˜¯å¯å˜çš„ï¼Œè¿™å–å†³äºç³»ç»Ÿæ¡ä»¶ã€‚å½“æ‚¨åˆ›å»ºå…·æœ‰å››ä¸ªä»»åŠ¡çš„å¹¶å‘é˜Ÿåˆ—æ—¶ï¼Œå®ƒä¼šåˆ›å»ºå¤šå°‘ä¸ªçº¿ç¨‹ï¼Ÿç­”æ¡ˆæ˜¯ä¸ç¡®å®šã€‚ GCD å°†ä½¿ç”¨å¤šå°‘ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œè¿™äº›ä»»åŠ¡ï¼Œè¿™å–å†³äºç³»ç»Ÿæ¡ä»¶ï¼Œå®ƒæœ‰å¯èƒ½å¯ä»¥ä½¿ç”¨ä¸€æ¡æˆ–å››æ¡çº¿ç¨‹ã€‚
5. åœ¨ GCD ä¸­ï¼Œæœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥åŒæ—¶è¿è¡Œä»»åŠ¡ï¼Œåˆ›å»ºè‡ªå®šä¹‰å¹¶å‘é˜Ÿåˆ—æˆ–ä½¿ç”¨å…¨å±€å¹¶å‘é˜Ÿåˆ—ã€‚

### è‡ªå®šä¹‰å’Œå…¨å±€å¹¶å‘é˜Ÿåˆ—çš„åŒºåˆ«

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ªå…¨å±€å¹¶å‘é˜Ÿåˆ—ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°ç”±äºå…¨å±€é˜Ÿåˆ—æ˜¯æ•´ä¸ªç³»ç»Ÿå…±äº«çš„å¹¶å‘é˜Ÿåˆ—ï¼Œå› æ­¤å®ƒå§‹ç»ˆè¿”å›ç›¸åŒçš„é˜Ÿåˆ—ï¼›è€Œè‡ªå®šä¹‰å¹¶å‘é˜Ÿåˆ—æ˜¯ç§æœ‰çš„ï¼Œæ¯æ¬¡åˆ›å»ºæ—¶éƒ½ä¼šè¿”å›æ–°é˜Ÿåˆ—ã€‚

![åˆ›å»ºå…¨å±€å¹¶å‘é˜Ÿåˆ—å’Œç³»ç»Ÿå¹¶å‘é˜Ÿåˆ—](http://images-for-blog.oss-cn-beijing.aliyuncs.com/2022/01/04/1k2jaj1siccaujscdcgkx4w.png)

æœ‰å››ä¸ªä¸åŒä¼˜å…ˆçº§çš„å…¨å±€å¹¶å‘é˜Ÿåˆ—ï¼Œä½†åœ¨è®¾ç½®å…¨å±€å¹¶å‘é˜Ÿåˆ—æ—¶ï¼Œä¸ç›´æ¥æŒ‡å®šä¼˜å…ˆçº§ã€‚ç›¸åï¼Œæ‚¨æŒ‡å®šæœåŠ¡è´¨é‡ (QoS)ï¼Œå…¶ä¸­åŒ…æ‹¬ç”¨æˆ·äº¤äº’ã€ç”¨æˆ·å¯åŠ¨ã€å®ç”¨ç¨‹åºå’Œåå°ï¼Œå…¶ä¸­ç”¨æˆ·äº¤äº’å…·æœ‰æœ€é«˜ä¼˜å…ˆçº§ï¼Œè€Œåå°å…·æœ‰æœ€ä½ä¼˜å…ˆçº§ã€‚ä¸‹é¢æ˜¯`QoS`çš„ä½¿ç”¨å»ºè®®ã€‚

1. `.userInteractive` æ ‡å¿—ä»»åŠ¡éœ€è¦è¢«ç«‹å³æ‰§è¡Œä»¥ä¾¿æä¾›æ›´å‡ºè‰²çš„ç”¨æˆ·ä½“éªŒã€‚é€šå¸¸ç”¨æ¥åš`UI`æ›´æ–°ï¼Œäº‹ä»¶å¤„ç†ç­‰ä½å»¶æ—¶çš„ä»»åŠ¡ã€‚è¯¥ç±»å‹çš„ä»»åŠ¡ä¸åº”è¿‡å¤šã€‚
2. `.userInitiated` æ ‡å¿—ä»»åŠ¡è¢«ç”¨æˆ·é€šè¿‡UIç•Œé¢åˆ›å»ºï¼Œä½†æ˜¯å¯ä»¥è¢«å¼‚æ­¥æ‰§è¡Œã€‚é€šå¸¸ç”¨åœ¨ç”¨æˆ·ä¸€ä¸ªæ“ä½œåéœ€è¦ç­‰å¾…ï¼Œç»“æœè¿”å›åç»§ç»­ä¹‹å‰çš„æ“ä½œã€‚
3. `.default` é»˜è®¤å€¼ã€‚ç”¨äºä¸€èˆ¬æ€§å¼‚æ­¥ä»»åŠ¡ã€‚
4. `.utility` æ ‡å¿—ä»»åŠ¡éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œé€šå¸¸ä¼šå…³è”ä¸€ä¸ªè¿›åº¦ã€‚æ¯”å¦‚ï¼š`I/O`ã€ç½‘ç»œè¯·æ±‚ç­‰ã€‚
5. `.background` æ ‡å¿—ä»»åŠ¡çš„æ‰§è¡Œç”¨æˆ·ä¸å¤ªä¼šå…³å¿ƒã€‚æ¯”å¦‚ï¼šé¢„åŠ è½½æ•°æ®ã€‚

ä¸å…¨å±€é˜Ÿåˆ—ç›¸æ¯”ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰é˜Ÿåˆ—æ‰§è¡Œä»¥ä¸‹ä»»åŠ¡ï¼š

1. æ‚¨å¯ä»¥æŒ‡å®šä¸€ä¸ªå¯¹æ‚¨æœ‰æ„ä¹‰çš„æ ‡ç­¾ï¼Œä»¥ä¾¿åœ¨è‡ªå®šä¹‰é˜Ÿåˆ—ä¸Šè¿›è¡Œè°ƒè¯•
2. ä½ å¯ä»¥æš‚åœå’Œé‡å¯: `queue.suspend() queue.resume()`
3. æäº¤`æ …æ ä»»åŠ¡`: `queue.async(flags: .barrier) { ... }`

### ä¸»é˜Ÿåˆ—

1. ä¸»é˜Ÿåˆ—æ˜¯ä¸€ä¸ªå…¨å±€å¯ç”¨çš„ä¸²è¡Œé˜Ÿåˆ—ï¼Œå®ƒåœ¨åº”ç”¨ç¨‹åºçš„ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œä»»åŠ¡
2. è¯¥é˜Ÿåˆ—ä¸åº”ç”¨ç¨‹åºçš„è¿è¡Œå¾ªç¯ä¸€èµ·å·¥ä½œï¼Œä»¥å°†æ’é˜Ÿä»»åŠ¡å’Œè¿è¡Œå¾ªç¯çš„å…¶ä»–äº‹ä»¶æºä»»åŠ¡äº¤é”™æ‰§è¡Œâ€‹â€‹ã€‚å› ä¸ºå®ƒåœ¨åº”ç”¨ç¨‹åºçš„ä¸»çº¿ç¨‹ä¸Šè¿è¡Œï¼Œæ‰€ä»¥ä¸»é˜Ÿåˆ—é€šå¸¸ç”¨ä½œåº”ç”¨ç¨‹åºçš„å…³é”®åŒæ­¥ç‚¹ã€‚

## åŒæ­¥ä¸å¼‚æ­¥

æˆ‘ä»¬å·²ç»å­¦ä¹ äº†å¦‚ä½•åœ¨é˜Ÿåˆ—ä¸Šä¸²è¡Œæˆ–å¹¶å‘åœ°æ‰§è¡Œä»»åŠ¡ã€‚ä½¿ç”¨ GCDï¼Œæ‚¨è¿˜å¯ä»¥åŒæ­¥æˆ–å¼‚æ­¥çš„è°ƒåº¦é˜Ÿåˆ—ã€‚

ä¸€èˆ¬æ¥è¯´ï¼ŒåŒæ­¥å‡½æ•°(`sync`)åœ¨ä»»åŠ¡å®Œæˆåå°†æ§åˆ¶æƒè¿”å›ç»™è°ƒç”¨è€…ã€‚è€Œå¼‚æ­¥å‡½æ•°(`async`)ä¼šåœ¨å‡½æ•°è°ƒç”¨åï¼Œç«‹å³å°†å°†æ§åˆ¶æƒè¿”å›ç»™è°ƒç”¨è€…ï¼Œå®ƒä¸ä¼šç­‰ç­‰ä»»åŠ¡å®Œæˆã€‚

![åŒæ­¥è°ƒç”¨](http://images-for-blog.oss-cn-beijing.aliyuncs.com/2022/01/04/1yn7wjssz5y8sk4aeegsvrg.png)

å¦‚ä¸Šå›¾ï¼Œæ‚¨åœ¨å¹¶å‘å…¨å±€é˜Ÿåˆ—ä¸Šæ‰§è¡Œè€—æ—¶çš„ä»»åŠ¡ï¼Œä½†ä¸»çº¿ç¨‹ä»ç„¶å¾ˆå¿™ï¼Œå› ä¸ºæ‚¨åœ¨ä¸»çº¿ç¨‹ `main` ä¸ŠåŒæ­¥åœ°åœ¨åˆ†æ´¾ä»»åŠ¡ï¼Œå®ƒä¼šä¸€ç›´ç­‰åˆ°ä»»åŠ¡æ‰§è¡Œå®Œæˆã€‚

![å¼‚æ­¥è°ƒç”¨](http://images-for-blog.oss-cn-beijing.aliyuncs.com/2022/01/04/1qx3qunao41jofwdqva85ew.png)

å¦‚ä¸Šå›¾ï¼šæˆ‘ä»¬å¼‚æ­¥çš„åˆ†æ´¾ä»»åŠ¡ï¼Œå®ƒç«‹å³è¿”å›åˆ°ä¸»çº¿ç¨‹ï¼Œä¸»çº¿ç¨‹å°†é¦–å…ˆæ‰“å°ï¼Œé˜Ÿåˆ—ä¸Šçš„åˆ—ä»»åŠ¡å°†å¹¶å‘æ‰§è¡Œã€‚

## é¢„é˜²æ­»é”

> åœ¨å¹¶å‘è®¡ç®—ä¸­ï¼Œæ­»é”æ˜¯ä¸€ä¸ªç»„çš„æ¯ä¸ªæˆå‘˜éƒ½åœ¨ç­‰å¾…å¦ä¸€ä¸ªæˆå‘˜ï¼ˆåŒ…æ‹¬å®ƒè‡ªå·±ï¼‰é‡‡å–è¡ŒåŠ¨çš„çŠ¶æ€

![æ­»é”](http://images-for-blog.oss-cn-beijing.aliyuncs.com/2022/01/04/16409312578474.jpg)

åœ¨ä¸Šå›¾ä¸­ï¼Œ`queue`æ˜¯ä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—ï¼Œé€šè¿‡`async`æ´¾å‘çš„ä»»åŠ¡Aï¼Œé€šè¿‡`sync`æ´¾å‘äº†ä»»åŠ¡Bã€‚æ­¤æ—¶Aä¼šç­‰å¾…Bå®Œæˆåç»§ç»­å‘ä¸‹ï¼Œè€ŒBåœ¨Aæ²¡æœ‰å®Œæˆä¹‹å‰æ˜¯ä¸ä¼šå¼€å§‹ã€‚è¿™å°±é€ æˆäº†æ­»é”ã€‚

![æ­»é”](http://images-for-blog.oss-cn-beijing.aliyuncs.com/2022/01/04/1pwwxshdfedzpeupn96m9xa.png)

åŒæ ·ï¼Œä¸Šå›¾çš„ä¸»é˜Ÿåˆ—ä»»åŠ¡A(viewDidLoadæ–¹æ³•)ä½¿ç”¨`sync`æ´¾å‘ä»»åŠ¡Bï¼Œä¹Ÿä¼šé€ æˆç›¸äº’ç­‰å¾…ä»è€Œæ­»é”ã€‚

## DispatchWorkItem

`DispatchWorkItem`æ˜¯ä¸€é¡¹ä»»åŠ¡çš„åŒ…è£…å™¨ï¼Œå¯ä»¥å¤šæ¬¡ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥å–æ¶ˆã€‚

```swift
let queue = DispatchQueue(label: "com.swiftpal.dispatch.workItem")

//  Create a work item
let workItem = DispatchWorkItem() {
    print("Stored Task")
}

// Task 1
queue.async(execute: workItem)

// Task 2
queue.asyncAfter(deadline: DispatchTime.now() + 1, execute: workItem)

// Work Item Cancel
workItem.cancel()

// Task 3
queue.async(execute: workItem)

if item.isCancelled {
    print("Task was cancelled")
}
```

è¿™é‡Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—ï¼Œåˆåˆ›å»ºäº†ä¸€ä¸ª`DispatchWorkItem`ï¼Œå®ƒåªåŒ…å«ä¸€å¥ä»£ç ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨å–æ¶ˆä»»åŠ¡ä¹‹å‰æ´¾å‘äº†è¯¥ä»»åŠ¡ä¸¤æ¬¡ï¼Œä¹‹åå†æ¬¡æ´¾å‘è¯¥ä»»åŠ¡ã€‚ä½†æ˜¯å¯¹äºè¾“å‡ºï¼Œæˆ‘ä»¬åªä¼šçœ‹åˆ°ä¸€æ¬¡`Stored task`ã€‚